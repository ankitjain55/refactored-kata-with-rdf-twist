image: ghcr.io/astral-sh/uv:0.10.4-python3.12-bookworm-slim

# âœ… Run pipeline on push AND merge request
workflow:
  rules:
    - if: $CI_PIPELINE_SOURCE == "push"
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"

stages:
  - lint
  - test

variables:
  UV_CACHE_DIR: .uv-cache

cache:
  key:
    files:
      - uv.lock
  paths:
    - .uv-cache/

before_script:
  - uv sync

lint:
  stage: lint
  script:
    - uv run ruff check python/
    - uv run ruff format --check python/
    - uv cache prune --ci

tests:
  stage: test
  script:
    - uv run pytest
    - uv cache prune --ci